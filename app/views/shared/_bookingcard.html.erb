<div class="cards mt-5">
  <div class="card">
    <h4 class ="card-header">
      <%= booking.ship.name %>
    </h4>
    <div class="card-body d-flex justify-content-between bk-header">
      <%= cl_image_tag booking.ship.photo.key if booking.ship.photo.attached? %>
      <div class="d-flex justify-content-center bk-header-details" >
        <div class="d-flex bk-header-details-block">
          <div>
            <h5>Owner</h5>
            <p class ='card-title'>
              <%= booking.ship.user.nickname.capitalize %>
            </p>
          </div>
<!-- TEMPORAIRE A SUPPRIMER -->
          <div>
            <h5>Id</h5>
            <p class ='card-title'>
              <%= booking.id %>
            </p>
          </div>
<!-- TEMPORAIRE A SUPPRIMER -->


          <div>
            <h5>User</h5>
            <p class ='card-title'>
              <%= booking.user.nickname.capitalize %>
            </p>
          </div>
        </div>
        <div class="d-flex bk-header-details-block">
          <div>
            <h5>Starting Date</h5>
            <p>
              <%= booking.date_start %>
            </p>
          </div>
          <div>
            <h5> Ending Date</h5>
            <p>
              <%= booking.date_end %>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="card-footer d-flex justify-content-around bk-footer" >
      <div>
        <h5>Status:</h5>
        <p><%=booking.status.capitalize %></p>
      </div>
      <div>
        <h5>Attendants:</h5>
        <p> <%= number_with_delimiter(booking.crew_size, delimiter:'.') %></p>
      </div>
      <div class="total-amount">
        <h5>Amount:</h5>
        <p> <%= number_with_delimiter(booking.total_amount, delimiter:'.') %> ðŸ‘¾</p>
      </div>
      <!-- Cas 1 : Pending/Owner-->
      <% if  booking.ship.user_id == current_user.id && booking.status.downcase == 'pending'%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to decline_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-danger'>Decline</button>
          <% end %>
          <%= link_to validate_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-success'>Accept</button>
          <% end %>
      <!-- Cas 3 : Validated/Owner Validated/User Paid/Owner Paid/User -->
      <% elsif  (booking.ship.user_id == current_user.id && ['validated', 'paid'].include?(booking.status.downcase)) || (booking.user_id == current_user.id && ['pending', 'validated', 'paid'].include?(booking.status.downcase))%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to decline_booking_path(booking), method: :patch, data: { confirm: "Are you sure?"} do %>
            <button class = 'btn btn-danger'>Cancel</button>
          <% end %>
      <!-- Cas 4 : Validated status can be paid (or not) by USER -->
        <% elsif  booking.user_id == current_user.id && booking.status.downcase == 'validated'%>
        <div class="buttons d-flex justify-content-around">
          <%= link_to decline_booking_path(booking), method: :patch do %>
            <button class = 'btn btn-info'>ðŸ‘¾ Pay ðŸ‘¾</button>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
